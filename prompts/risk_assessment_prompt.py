"""
í•œêµ­ ì£¼ì‹ ì‹œì¥ íŠ¹í™” ë¦¬ìŠ¤í¬ ë¶„ì„ í”„ë¡¬í”„íŠ¸
"""
from typing import Dict, Any, List
from datetime import datetime


def create_risk_assessment_prompt(
    multi_result: Dict[str, Any],
    ticker_list: List[str],
    analysis_focus: str = "risk_assessment"
) -> str:
    """
    í•œêµ­ ì£¼ì‹ ì‹œì¥ íŠ¹í™” ë¦¬ìŠ¤í¬ ë¶„ì„ í”„ë¡¬í”„íŠ¸ ìƒì„±

    Args:
        multi_result: ë‹¤ì¤‘ ì „ëµ ë¶„ì„ ê²°ê³¼
        ticker_list: ë¶„ì„ ëŒ€ìƒ ì¢…ëª© ë¦¬ìŠ¤íŠ¸
        analysis_focus: ë¶„ì„ ì´ˆì  (risk_assessment, portfolio_risk, market_risk)

    Returns:
        í•œêµ­ ì‹œì¥ íŠ¹í™” ë¦¬ìŠ¤í¬ ë¶„ì„ í”„ë¡¬í”„íŠ¸
    """
    current_time = datetime.now()
    market_status = "ì¥ì¤‘" if 9 <= current_time.hour <= 15 else "ì¥í›„"

    strategies_analyzed = multi_result.get('strategies_analyzed', 0)
    successful_strategies = multi_result.get('successful_strategies', 0)
    total_matches = multi_result.get('total_matches_found', 0)

    prompt = f"""ë‹¹ì‹ ì€ í•œêµ­ ì£¼ì‹ ì‹œì¥ì—ì„œ 20ë…„ ì´ìƒ ë¦¬ìŠ¤í¬ ê´€ë¦¬ë¥¼ ì „ë¬¸ìœ¼ë¡œ í•´ì˜¨ ë¦¬ìŠ¤í¬ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤.
KOSPIì™€ KOSDAQ ì‹œì¥ì˜ ë‹¤ì–‘í•œ ìœ„ê¸° ìƒí™©ì„ ê²½í—˜í–ˆìœ¼ë©°, í•œêµ­ ì‹œì¥ íŠ¹ìœ ì˜ ë¦¬ìŠ¤í¬ ìš”ì¸ë“¤ì„ ì •í™•íˆ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ì™¸í™˜ìœ„ê¸°, ê¸ˆìœµìœ„ê¸°, ì½”ë¡œë‚˜19 ë“± ì£¼ìš” ì‹œì¥ ì¶©ê²© ì‹œê¸°ì˜ ëŒ€ì‘ ê²½í—˜ì´ í’ë¶€í•©ë‹ˆë‹¤.

## âš ï¸ ë¦¬ìŠ¤í¬ ë¶„ì„ ë¦¬í¬íŠ¸

### ğŸ“Š ë¶„ì„ ê°œìš”
- **ë¶„ì„ ì‹œì **: {current_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')} KST ({market_status})
- **ë¶„ì„ ëŒ€ìƒ**: {len(ticker_list)}ê°œ ì¢…ëª©
- **ì ìš© ì „ëµ**: {strategies_analyzed}ê°œ (ì„±ê³µ: {successful_strategies}ê°œ)
- **ë°œê²¬ëœ ê¸°íšŒ**: {total_matches}ê°œ

### ğŸ¯ ë¶„ì„ í¬íŠ¸í´ë¦¬ì˜¤
{', '.join(ticker_list)}

## ğŸ“ˆ ì „ëµë³„ ë¦¬ìŠ¤í¬ í”„ë¡œíŒŒì¼:"""

    # ì „ëµë³„ ë¦¬ìŠ¤í¬ ë¶„ì„
    if 'results_by_strategy' in multi_result:
        for strategy_name, result in multi_result['results_by_strategy'].items():
            strategy_korean_name = _get_strategy_korean_name(strategy_name)
            matches_found = result.get('matches_found', 0)
            risk_level = _get_strategy_risk_level(strategy_name, matches_found)

            prompt += f"""

### ğŸ” {strategy_korean_name} ì „ëµ ë¦¬ìŠ¤í¬
- **ë§¤ì¹˜ëœ ì¢…ëª©**: {matches_found}ê°œ
- **ë¦¬ìŠ¤í¬ ë“±ê¸‰**: {risk_level}
- **ìœ„í—˜ ìš”ì¸**: {_get_strategy_risk_factors(strategy_name)}"""

            if matches_found > 0 and 'results' in result:
                prompt += "\n- **ìœ„í—˜ë„ë³„ ì¢…ëª© ë¶„ë¥˜**:"
                for match in result['results'][:3]:
                    ticker = match.get('ticker', 'N/A')
                    signal_strength = match.get('signal_strength', 0)
                    risk_grade = _get_individual_risk_grade(signal_strength)
                    prompt += f"\n  - {ticker}: {risk_grade}"

    if analysis_focus == "risk_assessment":
        prompt += f"""

## ğŸ›¡ï¸ ì¢…í•© ë¦¬ìŠ¤í¬ ë¶„ì„

### 1. ì‹œì¥ ë¦¬ìŠ¤í¬ (Market Risk)
#### ğŸ“Š ì‹œìŠ¤í…œì  ë¦¬ìŠ¤í¬
- **KOSPI ì§€ìˆ˜ ë¦¬ìŠ¤í¬**: í˜„ì¬ ì§€ìˆ˜ ìœ„ì¹˜ì™€ ì£¼ìš” ì§€ì§€/ì €í•­ì„  ì´íƒˆ ìœ„í—˜
- **KOSDAQ ë¦¬ìŠ¤í¬**: ì¤‘ì†Œí˜•ì£¼ ì‹œì¥ì˜ ë³€ë™ì„±ê³¼ ìœ ë™ì„± ìœ„í—˜
- **ì„¹í„° ì§‘ì¤‘ ë¦¬ìŠ¤í¬**: í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ íŠ¹ì • ì„¹í„° í¸ì¤‘ë„ ë¶„ì„
- **ì‹œì¥ ìƒê´€ê´€ê³„**: ì „ì²´ ì‹œì¥ í•˜ë½ ì‹œ ë™ë°˜ í•˜ë½ ìœ„í—˜ë„

#### ğŸŒ ëŒ€ì™¸ ìš”ì¸ ë¦¬ìŠ¤í¬
- **í™˜ìœ¨ ë¦¬ìŠ¤í¬**: ì›/ë‹¬ëŸ¬ í™˜ìœ¨ ë³€ë™ì´ í¬íŠ¸í´ë¦¬ì˜¤ì— ë¯¸ì¹˜ëŠ” ì˜í–¥
- **ë¯¸êµ­ ì‹œì¥ ë¦¬ìŠ¤í¬**: S&P500, ë‚˜ìŠ¤ë‹¥ ê¸‰ë½ ì‹œ í•œêµ­ ì‹œì¥ ì „ì´ ìœ„í—˜
- **ì¤‘êµ­ ì‹œì¥ ë¦¬ìŠ¤í¬**: ì¤‘êµ­ ê²½ì œ ë‘”í™”ê°€ í•œêµ­ ìˆ˜ì¶œê¸°ì—…ì— ë¯¸ì¹˜ëŠ” ì˜í–¥
- **ì›ìì¬ ê°€ê²© ë¦¬ìŠ¤í¬**: ìœ ê°€, ì›ìì¬ ê°€ê²© ê¸‰ë³€ ì‹œ ê´€ë ¨ ì—…ì¢… ì˜í–¥

### 2. ê°œë³„ ì¢…ëª© ë¦¬ìŠ¤í¬ (Specific Risk)
#### ğŸ¢ ê¸°ì—… íŠ¹ìˆ˜ ë¦¬ìŠ¤í¬
í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ì˜ ê° ì¢…ëª©ë³„ ê³ ìœ  ìœ„í—˜ ìš”ì¸ì„ ë¶„ì„í•´ì£¼ì„¸ìš”:
- **ì¬ë¬´ ê±´ì „ì„±**: ë¶€ì±„ë¹„ìœ¨, ìœ ë™ì„±, ìˆ˜ìµì„± ì§€í‘œ
- **ì‚¬ì—… êµ¬ì¡°**: ì£¼ë ¥ ì‚¬ì—…ì˜ ê²½ê¸° ë¯¼ê°ë„ì™€ ì„±ì¥ì„±
- **ê²½ì˜ì§„ ë¦¬ìŠ¤í¬**: ì§€ë°°êµ¬ì¡°, ê²½ì˜ì§„ ë³€í™”, ì •ì±… ë³€í™”
- **ê·œì œ ë¦¬ìŠ¤í¬**: ì—…ì¢…ë³„ ì •ë¶€ ê·œì œ ë³€í™” ê°€ëŠ¥ì„±

#### ğŸ“ˆ ê¸°ìˆ ì  ë¦¬ìŠ¤í¬
- **ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„**: í˜„ì¬ ê¸°ìˆ ì  ìœ„ì¹˜ì˜ ì¡°ì • ìœ„í—˜
- **ê±°ë˜ëŸ‰ ë¦¬ìŠ¤í¬**: ìœ ë™ì„± ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ê°€ê²© ì¶©ê²©
- **ì§€ì§€ì„  ì´íƒˆ**: ì£¼ìš” ê¸°ìˆ ì  ì§€ì§€ì„  ë¶•ê´´ ì‹œ ì¶”ê°€ í•˜ë½ ìœ„í—˜
- **ëª¨ë©˜í…€ ì†Œë©¸**: ìƒìŠ¹ ëª¨ë©˜í…€ ì•½í™” ì‹œ ìˆ˜ìµ ì‹¤í˜„ íƒ€ì´ë°

### 3. ìœ ë™ì„± ë¦¬ìŠ¤í¬ (Liquidity Risk)
#### ğŸ’§ ì‹œì¥ ìœ ë™ì„±
- **ì¼í‰ê·  ê±°ë˜ëŸ‰**: ê° ì¢…ëª©ì˜ ìœ ë™ì„± ì¶©ë¶„ì„± í‰ê°€
- **í˜¸ê°€ ìŠ¤í”„ë ˆë“œ**: ë§¤ìˆ˜/ë§¤ë„ í˜¸ê°€ ì°¨ì´ë¡œ ì¸í•œ ê±°ë˜ ë¹„ìš©
- **ëŒ€ëŸ‰ ê±°ë˜ ì¶©ê²©**: í° ê¸ˆì•¡ ê±°ë˜ ì‹œ ê°€ê²© ì¶©ê²© ì •ë„
- **ì‹œì¥ ìŠ¤íŠ¸ë ˆìŠ¤**: ê¸‰ë½ì¥ì—ì„œì˜ ë§¤ë„ ê°€ëŠ¥ì„±

#### ğŸ¦ ìê¸ˆ ì¡°ë‹¬ ë¦¬ìŠ¤í¬
- **ë ˆë²„ë¦¬ì§€ ìœ„í—˜**: ì‹ ìš© ê±°ë˜ë‚˜ ëŒ€ì¶œ íˆ¬ì ì‹œ ì¶”ê°€ ìœ„í—˜
- **ë§ˆì§„ì½œ ë¦¬ìŠ¤í¬**: ê¸‰ë½ ì‹œ ì¶”ê°€ ì¦ê±°ê¸ˆ ìš”êµ¬ ê°€ëŠ¥ì„±
- **ìê¸ˆ íšŒìˆ˜**: ê¸´ê¸‰ ìê¸ˆ í•„ìš” ì‹œ ì†ì‹¤ ë§¤ë„ ìœ„í—˜

### 4. ìš´ì˜ ë¦¬ìŠ¤í¬ (Operational Risk)
#### ğŸ”§ ì‹œìŠ¤í…œ ë¦¬ìŠ¤í¬
- **ê±°ë˜ ì‹œìŠ¤í…œ**: ì¦ê¶Œì‚¬ ì‹œìŠ¤í…œ ì¥ì•  ì‹œ ë§¤ë§¤ ë¶ˆê°€ ìœ„í—˜
- **ì¸í„°ë„· ì—°ê²°**: ë„¤íŠ¸ì›Œí¬ ì¥ì• ë¡œ ì¸í•œ ë§¤ë§¤ ì°¨ì§ˆ
- **ì£¼ë¬¸ ì˜¤ë¥˜**: ì˜ëª»ëœ ì£¼ë¬¸ìœ¼ë¡œ ì¸í•œ ì˜ë„ì¹˜ ì•Šì€ ì†ì‹¤

#### ğŸ§  ì‹¬ë¦¬ì  ë¦¬ìŠ¤í¬
- **ê°ì •ì  ë§¤ë§¤**: ê³µí¬ë‚˜ íƒìš•ì— ì˜í•œ ë¹„í•©ë¦¬ì  ì˜ì‚¬ê²°ì •
- **í™•ì¦ í¸í–¥**: ìì‹ ì˜ íŒë‹¨ì„ ë’·ë°›ì¹¨í•˜ëŠ” ì •ë³´ë§Œ ìˆ˜ì§‘í•˜ëŠ” ê²½í–¥
- **ì†ì‹¤ íšŒí”¼**: ì†ì ˆë§¤ë¥¼ ë¯¸ë£¨ê³  ì†ì‹¤ì„ í‚¤ìš°ëŠ” ì‹¬ë¦¬ì  í•¨ì •

### 5. í•œêµ­ ì‹œì¥ íŠ¹í™” ë¦¬ìŠ¤í¬
#### ğŸ‡°ğŸ‡· ì œë„ì  ë¦¬ìŠ¤í¬
- **ì •ì¹˜ì  ë¦¬ìŠ¤í¬**: ì •ë¶€ ì •ì±… ë³€í™”, ì„ ê±° ê²°ê³¼ê°€ ì‹œì¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥
- **ê·œì œ ë³€í™”**: ê¸ˆìœµë‹¹êµ­ì˜ ê·œì œ ì •ì±… ë³€í™” (ê³µë§¤ë„, ì„¸ê¸ˆ ë“±)
- **ë¶í•œ ë¦¬ìŠ¤í¬**: ì§€ì •í•™ì  ê¸´ì¥ ê³ ì¡° ì‹œ ì‹œì¥ ì¶©ê²© (ì½”ë¦¬ì•„ ë””ìŠ¤ì¹´ìš´íŠ¸)
- **ëŒ€ê¸°ì—… ì§‘ì¤‘**: ì‚¼ì„±, SK ë“± ëŒ€ê¸°ì—… ì˜ì¡´ë„ê°€ ë†’ì€ ì‹œì¥ êµ¬ì¡°

#### ğŸ“Š ì‹œì¥ êµ¬ì¡°ì  ë¦¬ìŠ¤í¬
- **ì™¸êµ­ì¸ ì˜ì¡´**: ì™¸êµ­ì¸ íˆ¬ìì ë¹„ì¤‘ì´ ë†’ì•„ ìê¸ˆ ì´íƒˆ ìœ„í—˜
- **ê°œì¸ íˆ¬ìì**: ê°œë¯¸ íˆ¬ììì˜ ê°ì •ì  ë§¤ë§¤ë¡œ ì¸í•œ ë³€ë™ì„± í™•ëŒ€
- **í”„ë¡œê·¸ë¨ ë§¤ë§¤**: ì•Œê³ ë¦¬ì¦˜ íŠ¸ë ˆì´ë”©ìœ¼ë¡œ ì¸í•œ ê¸‰ê²©í•œ ê°€ê²© ë³€ë™

**ëª¨ë“  ë¦¬ìŠ¤í¬ ìš”ì¸ì„ í•œêµ­ ì‹œì¥ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.**"""

    elif analysis_focus == "portfolio_risk":
        prompt += f"""

## ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ìŠ¤í¬ ìƒì„¸ ë¶„ì„

### 1. í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ë¦¬ìŠ¤í¬
#### ğŸ¯ ì§‘ì¤‘ë„ ìœ„í—˜
- **ì¢…ëª© ì§‘ì¤‘**: ê°œë³„ ì¢…ëª©ë³„ ë¹„ì¤‘ê³¼ ì§‘ì¤‘ë„ ìœ„í—˜
- **ì„¹í„° ì§‘ì¤‘**: ì—…ì¢…ë³„ ë¶„ì‚° ì •ë„ì™€ ì„¹í„° ë¦¬ìŠ¤í¬
- **ì‹œê°€ì´ì•¡ ì§‘ì¤‘**: ëŒ€í˜•ì£¼/ì¤‘ì†Œí˜•ì£¼ ë¹„ì¤‘ì˜ ì ì •ì„±
- **ì§€ì—­ ì§‘ì¤‘**: í•œêµ­ ì‹œì¥ ì§‘ì¤‘ìœ¼ë¡œ ì¸í•œ êµ­ê°€ ë¦¬ìŠ¤í¬

#### ğŸ”— ìƒê´€ê´€ê³„ ë¦¬ìŠ¤í¬
- **ì¢…ëª© ê°„ ìƒê´€ê´€ê³„**: í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ ì¢…ëª©ë“¤ì˜ ë™ì¡°í™” ìœ„í—˜
- **ì‹œì¥ ë² íƒ€**: ì „ì²´ ì‹œì¥ ëŒ€ë¹„ í¬íŠ¸í´ë¦¬ì˜¤ì˜ ë¯¼ê°ë„
- **ì„¹í„° ë¡œí…Œì´ì…˜**: ì—…ì¢…ë³„ ìê¸ˆ ì´ë™ ì‹œ í¬íŠ¸í´ë¦¬ì˜¤ ì˜í–¥

### 2. ë¦¬ìŠ¤í¬ ì¸¡ì • ì§€í‘œ
#### ğŸ“ í†µê³„ì  ë¦¬ìŠ¤í¬ ì§€í‘œ
ê° ì¢…ëª©ì˜ ê³¼ê±° ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ ì§€í‘œë“¤ì„ ë¶„ì„í•´ì£¼ì„¸ìš”:
- **ë³€ë™ì„±(Volatility)**: ê°œë³„ ì¢…ëª© ë° í¬íŠ¸í´ë¦¬ì˜¤ ì „ì²´ ë³€ë™ì„±
- **ìµœëŒ€ ë‚™í­(Maximum Drawdown)**: ê³¼ê±° ìµœëŒ€ í•˜ë½í­ ë¶„ì„
- **VaR(Value at Risk)**: 95% ì‹ ë¢°êµ¬ê°„ì—ì„œ ì˜ˆìƒ ìµœëŒ€ ì†ì‹¤
- **ìƒ¤í”„ ë¹„ìœ¨**: ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµë¥ ì˜ íš¨ìœ¨ì„±

#### âš–ï¸ ë¦¬ìŠ¤í¬ ì¡°ì • ìˆ˜ìµë¥ 
- **ìœ„í—˜ ì¡°ì • ìˆ˜ìµë¥ **: ë³€ë™ì„±ì„ ê³ ë ¤í•œ ì‹¤ì§ˆì  ìˆ˜ìµì„±
- **ì •ë³´ ë¹„ìœ¨**: ë²¤ì¹˜ë§ˆí¬ ëŒ€ë¹„ ì´ˆê³¼ ìˆ˜ìµì˜ ì•ˆì •ì„±
- **ì†Œë¥´í‹°ë…¸ ë¹„ìœ¨**: í•˜ë°© ìœ„í—˜ë§Œì„ ê³ ë ¤í•œ ìˆ˜ìµë¥  ì§€í‘œ

### 3. ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„
#### ğŸ“‰ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë³„ í¬íŠ¸í´ë¦¬ì˜¤ ì˜í–¥ë„ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:
- **ê¸‰ë½ ì‹œë‚˜ë¦¬ì˜¤**: KOSPI 10% í•˜ë½ ì‹œ í¬íŠ¸í´ë¦¬ì˜¤ ì˜í–¥
- **ê¸ˆë¦¬ ìƒìŠ¹**: ê¸°ì¤€ê¸ˆë¦¬ 1%p ìƒìŠ¹ ì‹œ ì˜í–¥
- **í™˜ìœ¨ ê¸‰ë“±**: ì›/ë‹¬ëŸ¬ 1,500ì› ëŒíŒŒ ì‹œ ì˜í–¥
- **ì¤‘êµ­ ê²½ì œ ë‘”í™”**: ì¤‘êµ­ GDP ì„±ì¥ë¥  5% í•˜íšŒ ì‹œ ì˜í–¥

#### ğŸ”„ íšŒë³µ ì‹œë‚˜ë¦¬ì˜¤
- **ë°˜ë“± ì‹œë‚˜ë¦¬ì˜¤**: ì‹œì¥ íšŒë³µ ì‹œ í¬íŠ¸í´ë¦¬ì˜¤ íƒ„ë ¥ì„±
- **ì„¹í„° ë¡œí…Œì´ì…˜**: ì—…ì¢… ìê¸ˆ ì´ë™ ì‹œ ìˆ˜í˜œ ê°€ëŠ¥ì„±
- **ì •ì±… í˜¸ì¬**: ì •ë¶€ ë¶€ì–‘ì±… ë°œí‘œ ì‹œ ìˆ˜í˜œë„"""

    else:  # market_risk
        prompt += f"""

## ğŸŒŠ ì‹œì¥ ë¦¬ìŠ¤í¬ ì „ë¬¸ ë¶„ì„

### 1. ê±°ì‹œê²½ì œ ë¦¬ìŠ¤í¬
#### ğŸ›ï¸ êµ­ë‚´ ê²½ì œ ë¦¬ìŠ¤í¬
- **ê²½ì œì„±ì¥ë¥ **: GDP ì„±ì¥ë¥  ë‘”í™”ê°€ ê¸°ì—… ì‹¤ì ì— ë¯¸ì¹˜ëŠ” ì˜í–¥
- **ë¬¼ê°€ ìƒìŠ¹**: ì¸í”Œë ˆì´ì…˜ ì••ë ¥ê³¼ ì†Œë¹„ ìœ„ì¶• ê°€ëŠ¥ì„±
- **ê³ ìš© ì‹œì¥**: ì‹¤ì—…ë¥  ìƒìŠ¹ê³¼ ì†Œë¹„ ì‹¬ë¦¬ ìœ„ì¶•
- **ë¶€ë™ì‚° ì‹œì¥**: ë¶€ë™ì‚° ê°€ê²© í•˜ë½ê³¼ ê¸ˆìœµê¶Œ ì˜í–¥

#### ğŸŒ ê¸€ë¡œë²Œ ê²½ì œ ë¦¬ìŠ¤í¬
- **ë¯¸êµ­ ê²½ì œ**: ë¯¸êµ­ ê²½ê¸° ì¹¨ì²´ ì‹œ ê¸€ë¡œë²Œ ê²½ì œ ì˜í–¥
- **ì¤‘êµ­ ê²½ì œ**: ì¤‘êµ­ ê²½ì œ ë‘”í™”ì™€ í•œêµ­ ìˆ˜ì¶œ ê¸°ì—… íƒ€ê²©
- **ìœ ëŸ½ ë¦¬ìŠ¤í¬**: ìœ ëŸ½ ê¸ˆìœµ ë¶ˆì•ˆê³¼ ê¸€ë¡œë²Œ ë¦¬ìŠ¤í¬ ì˜¤í”„
- **ì‹ í¥êµ­ ìœ„ê¸°**: ì‹ í¥êµ­ ê¸ˆìœµ ìœ„ê¸°ì˜ ì „ì´ íš¨ê³¼

### 2. ì •ì±… ë¦¬ìŠ¤í¬
#### ğŸ›ï¸ í†µí™”ì •ì±… ë¦¬ìŠ¤í¬
- **ê¸°ì¤€ê¸ˆë¦¬**: í•œêµ­ì€í–‰ ê¸ˆë¦¬ ì •ì±… ë³€í™” ì˜í–¥
- **ì–‘ì ì™„í™”**: ìœ ë™ì„± ì •ì±… ë³€í™”ì™€ ìì‚° ê°€ê²© ì˜í–¥
- **í™˜ìœ¨ ì •ì±…**: ë‹¹êµ­ì˜ í™˜ìœ¨ ê°œì…ê³¼ ì‹œì¥ ì˜í–¥

#### ğŸ“Š ì¬ì •ì •ì±… ë¦¬ìŠ¤í¬
- **ì •ë¶€ ì§€ì¶œ**: ì¬ì • ì •ì±… ë³€í™”ì™€ ê´€ë ¨ ì—…ì¢… ì˜í–¥
- **ì„¸ì œ ê°œí¸**: ì¦ê¶Œ ê±°ë˜ì„¸, ì–‘ë„ì†Œë“ì„¸ ë“± ì„¸ì œ ë³€í™”
- **ê·œì œ ì •ì±…**: ê¸ˆìœµ ê·œì œ ê°•í™”ì™€ ì‹œì¥ ìœ ë™ì„± ì˜í–¥

### 3. ì§€ì •í•™ì  ë¦¬ìŠ¤í¬
#### ğŸŒ í•œë°˜ë„ ë¦¬ìŠ¤í¬
- **ë¶í•œ ë„ë°œ**: êµ°ì‚¬ì  ê¸´ì¥ ê³ ì¡° ì‹œ ì‹œì¥ ì¶©ê²©
- **í†µì¼ ë¹„ìš©**: ì¥ê¸°ì  í†µì¼ ë¹„ìš©ê³¼ ê²½ì œì  ë¶€ë‹´
- **ì¤‘êµ­ ê´€ê³„**: ì‚¬ë“œ ê°ˆë“±ê³¼ ê°™ì€ ì™¸êµì  ë§ˆì°°

#### ğŸŒ ê¸€ë¡œë²Œ ë¦¬ìŠ¤í¬
- **ë¯¸ì¤‘ ê°ˆë“±**: ë¯¸ì¤‘ ë¬´ì—­ì „ìŸê³¼ ê¸°ìˆ  íŒ¨ê¶Œ ê²½ìŸ
- **ëŸ¬ì‹œì•„ ì‚¬íƒœ**: ìš°í¬ë¼ì´ë‚˜ ì „ìŸê³¼ ì›ìì¬ ê°€ê²©
- **ì¤‘ë™ ì •ì„¸**: ì§€ì •í•™ì  ë¶ˆì•ˆê³¼ ìœ ê°€ ê¸‰ë“± ìœ„í—˜

**ê° ë¦¬ìŠ¤í¬ ìš”ì¸ë³„ë¡œ í•œêµ­ ì‹œì¥ì— ë¯¸ì¹˜ëŠ” êµ¬ì²´ì  ì˜í–¥ë„ì™€ ëŒ€ì‘ ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.**"""

    prompt += f"""

## ğŸ¯ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì „ëµ

### ğŸ“‹ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë¦¬ìŠ¤í¬ ê´€ë¦¬
1. **í¬ì§€ì…˜ ì‚¬ì´ì§•**: ê°œë³„ ì¢…ëª© ë¹„ì¤‘ì„ í¬íŠ¸í´ë¦¬ì˜¤ì˜ 15% ì´í•˜ë¡œ ì œí•œ
2. **ì†ì ˆë§¤ ì„¤ì •**: ëª¨ë“  ì¢…ëª©ì— ëŒ€í•´ 8-10% ì†ì ˆë§¤ ë¼ì¸ ì„¤ì •
3. **ë¶„ì‚° íˆ¬ì**: ìµœì†Œ 3ê°œ ì´ìƒ ì„¹í„°ì— ë¶„ì‚° íˆ¬ì
4. **í˜„ê¸ˆ ë³´ìœ **: í¬íŠ¸í´ë¦¬ì˜¤ì˜ 10-20% í˜„ê¸ˆ ë³´ìœ ë¡œ ìœ ë™ì„± í™•ë³´

### âš–ï¸ ë¦¬ìŠ¤í¬ ëª¨ë‹ˆí„°ë§ ì§€í‘œ
#### ğŸš¨ ì¼ì¼ ëª¨ë‹ˆí„°ë§
- **VIX ì§€ìˆ˜**: ì‹œì¥ ê³µí¬ ì§€ìˆ˜ ìƒìŠ¹ ì‹œ í¬ì§€ì…˜ ì¶•ì†Œ ê³ ë ¤
- **ì›/ë‹¬ëŸ¬ í™˜ìœ¨**: 1,400ì› ëŒíŒŒ ì‹œ ìˆ˜ì¶œì£¼ ë¦¬ìŠ¤í¬ ì ê²€
- **KOSPI ì§€ì§€ì„ **: ì£¼ìš” ê¸°ìˆ ì  ì§€ì§€ì„  ì´íƒˆ ì‹œ ê²½ê³„ ê°•í™”
- **ì™¸êµ­ì¸ ë§¤ë§¤**: ì—°ì† 3ì¼ ì´ìƒ ìˆœë§¤ë„ ì‹œ ì‹œì¥ ì‹¬ë¦¬ ì•…í™” ê²½ê³„

#### ğŸ“Š ì£¼ê°„ ëª¨ë‹ˆí„°ë§
- **ì—…ì¢…ë³„ ìê¸ˆ íë¦„**: ì„¹í„° ë¡œí…Œì´ì…˜ íŒ¨í„´ ë³€í™” ì¶”ì 
- **ì‹ ìš© ê±°ë˜**: ì‹ ìš© ì”ê³  ê¸‰ì¦ ì‹œ ì¡°ì • ìœ„í—˜ ì¦ê°€
- **ê³µë§¤ë„ ë¹„ìœ¨**: ê³µë§¤ë„ ê¸‰ì¦ ì¢…ëª©ì˜ ì¶”ê°€ í•˜ë½ ìœ„í—˜
- **ê¸°ê´€ ë§¤ë§¤**: ê¸°ê´€ íˆ¬ììì˜ ëŒ€ëŸ‰ ë§¤ë„ íŒ¨í„´ ê°ì§€

### ğŸ›¡ï¸ ìœ„ê¸° ìƒí™© ëŒ€ì‘ ì‹œë‚˜ë¦¬ì˜¤
#### ğŸ”´ ê³ ìœ„í—˜ ìƒí™© (ì‹œì¥ 5% ì´ìƒ ê¸‰ë½)
1. **ì¦‰ì‹œ í–‰ë™**: ì†ì ˆë§¤ ë¼ì¸ ë„ë‹¬ ì¢…ëª© ì¦‰ì‹œ ë§¤ë„
2. **í¬ì§€ì…˜ ì¶•ì†Œ**: ì „ì²´ ì£¼ì‹ ë¹„ì¤‘ì„ 50% ì´í•˜ë¡œ ì¶•ì†Œ
3. **í˜„ê¸ˆ í™•ë³´**: ì¶”ê°€ ë§¤ìˆ˜ ê¸°íšŒ ëŒ€ë¹„ í˜„ê¸ˆ ë¹„ì¤‘ í™•ëŒ€
4. **ê°ì • í†µì œ**: íŒ¨ë‹‰ ë§¤ë„ ê¸ˆì§€, ê³„íšì  ëŒ€ì‘ ì‹¤í–‰

#### ğŸŸ¡ ì¤‘ìœ„í—˜ ìƒí™© (ì‹œì¥ 2-5% ì¡°ì •)
1. **ê´€ì°° ê°•í™”**: ì£¼ìš” ì§€í‘œ ëª¨ë‹ˆí„°ë§ ë¹ˆë„ ì¦ê°€
2. **ë¶€ë¶„ ë§¤ë„**: ìˆ˜ìµ ì‹¤í˜„ì„ í†µí•œ ìœ„í—˜ ë…¸ì¶œ ê°ì†Œ
3. **ì¬ì§„ì… ì¤€ë¹„**: ì¶”ê°€ í•˜ë½ ì‹œ ë§¤ìˆ˜ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì¤€ë¹„
4. **í—¤ì§€ ê²€í† **: í’‹ì˜µì…˜ ë“± í—¤ì§€ ì „ëµ ê²€í† 

### ğŸ“ˆ ê¸°íšŒ í¬ì°© ì „ëµ
#### ğŸ’ ìœ„ê¸°ë¥¼ ê¸°íšŒë¡œ
- **ë°”ê² í—ŒíŒ…**: ê³¼ë„í•œ ë§¤ë„ë¡œ ì €í‰ê°€ëœ ìš°ëŸ‰ì£¼ ë°œêµ´
- **ë¶„í•  ë§¤ìˆ˜**: í•˜ë½ì¥ì—ì„œ ìš°ëŸ‰ì£¼ì˜ ì ì§„ì  ë§¤ìˆ˜
- **ì„¹í„° ë¡œí…Œì´ì…˜**: ìƒëŒ€ì ìœ¼ë¡œ ê²¬ì¡°í•œ ë°©ì–´ ì„¹í„° ì§‘ì¤‘
- **ì¥ê¸° ê´€ì **: ë‹¨ê¸° ë³€ë™ì„±ì„ ë„˜ì–´ì„  ì¥ê¸° íˆ¬ì ê¸°íšŒ í¬ì°©

**ëª¨ë“  ë¦¬ìŠ¤í¬ ê´€ë¦¬ëŠ” í•œêµ­ ì‹œì¥ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•˜ê³  êµ¬ì²´ì ì¸ ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.
íŠ¹íˆ ê°œì¸ íˆ¬ììê°€ ì‹¤ì œë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” í˜„ì‹¤ì ì´ê³  ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.**"""

    return prompt


def _get_strategy_korean_name(strategy_name: str) -> str:
    """ì „ëµëª…ì„ í•œêµ­ì–´ë¡œ ë³€í™˜"""
    strategy_names = {
        'dictmacdgoldencrossstrategy': 'MACD ê³¨ë“ í¬ë¡œìŠ¤',
        'dictrsioversoldstrategy': 'RSI ê³¼ë§¤ë„ ë°˜ë“±',
        'dictbollingersqueezestrategy': 'ë³¼ë¦°ì € ë°´ë“œ ìŠ¤í€´ì¦ˆ',
        'dictmovingaveragecrossoverstrategy': 'ì´ë™í‰ê· ì„  êµì°¨'
    }
    return strategy_names.get(strategy_name, strategy_name)


def _get_strategy_risk_level(strategy_name: str, matches_found: int) -> str:
    """ì „ëµë³„ ë¦¬ìŠ¤í¬ ë“±ê¸‰ í‰ê°€"""
    base_risk = {
        'dictmacdgoldencrossstrategy': 'ì¤‘ìœ„í—˜',
        'dictrsioversoldstrategy': 'ê³ ìœ„í—˜',
        'dictbollingersqueezestrategy': 'ê³ ìœ„í—˜',
        'dictmovingaveragecrossoverstrategy': 'ì¤‘ìœ„í—˜'
    }

    risk = base_risk.get(strategy_name, 'ì¤‘ìœ„í—˜')

    # ë§¤ì¹˜ ìˆ˜ê°€ ë§ìœ¼ë©´ ë¦¬ìŠ¤í¬ ì¦ê°€ (ì‹œì¥ ê³¼ì—´ ê°€ëŠ¥ì„±)
    if matches_found >= 5:
        if risk == 'ì¤‘ìœ„í—˜':
            risk = 'ê³ ìœ„í—˜'
        elif risk == 'ì €ìœ„í—˜':
            risk = 'ì¤‘ìœ„í—˜'
    elif matches_found == 0:
        risk = 'ì €ìœ„í—˜ (ê¸°íšŒ ë¶€ì¬)'

    return risk


def _get_strategy_risk_factors(strategy_name: str) -> str:
    """ì „ëµë³„ ì£¼ìš” ìœ„í—˜ ìš”ì¸"""
    risk_factors = {
        'dictmacdgoldencrossstrategy': 'í•˜ë½ì¥ì—ì„œ ê±°ì§“ ì‹ í˜¸, í›„í–‰ì„± ì§€í‘œ í•œê³„, ë°•ìŠ¤ê¶Œì—ì„œ ì¦ì€ ì‹ í˜¸',
        'dictrsioversoldstrategy': 'ì§€ì†ì  í•˜ë½ ì‹œ ì¶”ê°€ ì†ì‹¤, ë‹¨ê¸° ë³€ë™ì„±, ë°˜ë“± ì‹¤íŒ¨ ìœ„í—˜',
        'dictbollingersqueezestrategy': 'ë°©í–¥ì„± ì˜ˆì¸¡ ì–´ë ¤ì›€, ë†’ì€ ë³€ë™ì„±, ë¹ ë¥¸ ì†ì ˆ ìš”êµ¬ë¨',
        'dictmovingaveragecrossoverstrategy': 'íš¡ë³´ì¥ ê±°ì§“ ì‹ í˜¸, í›„í–‰ì„±, ì¶”ì„¸ ì „í™˜ì  íŒŒì•… ì–´ë ¤ì›€'
    }
    return risk_factors.get(strategy_name, 'ì¼ë°˜ì ì¸ ì‹œì¥ ë¦¬ìŠ¤í¬')


def _get_individual_risk_grade(signal_strength: float) -> str:
    """ê°œë³„ ì¢…ëª© ë¦¬ìŠ¤í¬ ë“±ê¸‰"""
    if signal_strength >= 0.9:
        return "ì €ìœ„í—˜ (ê°•í•œ ì‹ í˜¸)"
    elif signal_strength >= 0.8:
        return "ì¤‘ì €ìœ„í—˜ (ì–‘í˜¸í•œ ì‹ í˜¸)"
    elif signal_strength >= 0.7:
        return "ì¤‘ìœ„í—˜ (ë³´í†µ ì‹ í˜¸)"
    elif signal_strength >= 0.6:
        return "ì¤‘ê³ ìœ„í—˜ (ì•½í•œ ì‹ í˜¸)"
    else:
        return "ê³ ìœ„í—˜ (ë§¤ìš° ì•½í•œ ì‹ í˜¸)"